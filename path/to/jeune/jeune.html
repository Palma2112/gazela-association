<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gestion des jeunes par vague</title>
    <link rel="stylesheet" href="jeune.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6.26.0/babel.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light glass-nav fixed-top">
      <div class="container">
        <a class="navbar-brand fw-bold d-flex align-items-center" href="#">
          <img src="../../../img/gazela-logo.png" class="logo" />
        </a>

        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#nav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div id="nav" class="collapse navbar-collapse">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="#">Accueil</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../bord.html">Tableau de bord</a>
            </li>

            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle active"
                data-bs-toggle="dropdown"
                >Jeunes</a
              >
              <ul class="dropdown-menu">
                <li>
                  <a class="dropdown-item" href="jeune/jeune.html"
                    >Programme 1</a
                  >
                </li>
                <li><a class="dropdown-item" href="#">Programme 2</a></li>
              </ul>
            </li>

            <li class="nav-item">
              <a class="nav-link" href="../actualite.html">Actualités</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Ressources</a>
            </li>
            <li class="nav-item"><a class="nav-link" href="#">Bénévolat</a></li>
          </ul>
        </div>
      </div>
    </nav>
    <div class="container" style="margin-top: 150px">
      <h1 class="mb-4">Gestion des jeunes par vague</h1>
      <button
        class="btn btn-success mb-3"
        onclick="window.location.href='add-jeune.html'"
      >
        + Ajouter un jeune
      </button>
      <div id="react-root"></div>
    </div>

    <script type="text/babel">
      const { useState, useEffect } = React;

      // Config Firebase
      const firebaseConfig = {
        apiKey: "AIzaSyDBMXFG1hRdZgottPlkTUTT0KacyXD70TA",
        authDomain: "gazela-31196.firebaseapp.com",
        projectId: "gazela-31196",
        storageBucket: "gazela-31196.firebasestorage.app",
        messagingSenderId: "684160987114",
        appId: "1:684160987114:web:36bc996595b5bdc4a60c93",
      };

      if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

      function JeuneAccordion(props) {
        const j = props.jeune;
        const index = props.index;
        return (
          <div className="accordion-item">
            <h2
              className="accordion-header"
              id={"heading" + props.parent + index}
            >
              <button
                className="accordion-button collapsed"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target={"#collapse" + props.parent + index}
                aria-expanded="false"
                aria-controls={"collapse" + props.parent + index}
              >
                {j.nom || "Nom inconnu"}
              </button>
            </h2>
            <div
              id={"collapse" + props.parent + index}
              className="accordion-collapse collapse"
              aria-labelledby={"heading" + props.parent + index}
              data-bs-parent={"#accordion" + props.parent}
            >
              <div className="accordion-body">
                <p>Âge : {j.age || "—"}</p>
                <p>Programme : {j.programme || "—"}</p>
                <p>Téléphone : {j.telephone || "—"}</p>
                <p>Dernière présence : {j.dernierePresence || "—"}</p>
                <span
                  className={
                    "badge " +
                    (j.statut === "actif"
                      ? "bg-success"
                      : j.statut === "inactif"
                      ? "bg-secondary"
                      : "bg-warning")
                  }
                >
                  {j.statut || "—"}
                </span>
                <div className="mt-3">
                  <button
                    className="btn btn-warning me-2"
                    onClick={props.onEdit}
                  >
                    Modifier
                  </button>
                  <button className="btn btn-danger" onClick={props.onDelete}>
                    Supprimer
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      }

      function App() {
        const [jeunes, setJeunes] = useState([]);
        const [search, setSearch] = useState("");

        useEffect(function () {
          var colRef = db.collection("jeunes");
          var unsub = colRef.onSnapshot(function (snap) {
            var data = snap.docs.map(function (d) {
              return {
                id: d.id,
                nom: d.data().nom,
                age: d.data().age,
                programme: d.data().programme,
                telephone: d.data().telephone,
                dernierePresence: d.data().dernierePresence,
                statut: d.data().statut,
                vague: d.data().vague || "Vague 1",
              };
            });
            setJeunes(data);
          });
          return unsub;
        }, []);

        var filtered = jeunes.filter(function (j) {
          return (
            j.nom && j.nom.toLowerCase().indexOf(search.toLowerCase()) !== -1
          );
        });

        const vagues = ["Vague 1", "Vague 2", "Vague 3"];

        return (
          <div>
            <input
              className="form-control mb-3"
              placeholder="Rechercher un jeune"
              value={search}
              onChange={function (e) {
                setSearch(e.target.value);
              }}
            />

            {vagues.map(function (vagueName, vi) {
              const jeunesVague = filtered.filter(function (j) {
                return j.vague === vagueName;
              });
              if (jeunesVague.length === 0) return null;
              return (
                <div key={vi} className="mb-4">
                  <h3>{vagueName}</h3>
                  <div className="accordion" id={"accordion" + vi}>
                    {jeunesVague.map(function (j, i) {
                      return (
                        <JeuneAccordion
                          key={j.id}
                          index={i}
                          parent={vi}
                          jeune={j}
                          onEdit={function () {
                            localStorage.setItem("editID", j.id);
                            window.location.href = "add-jeune.html";
                          }}
                          onDelete={function () {
                            if (confirm("Supprimer ce jeune ?")) {
                              db.collection("jeunes").doc(j.id).delete();
                            }
                          }}
                        />
                      );
                    })}
                  </div>
                </div>
              );
            })}
          </div>
        );
      }

      ReactDOM.render(<App />, document.getElementById("react-root"));
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
